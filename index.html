<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MVB Logística 360 — Calculadora, Rastreamento & GPS</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
  <style>
    body{margin:0;background:#0f172a;color:#e2e8f0;font:500 16px/1.6 system-ui,Arial}
    .wrap{max-width:1100px;margin:40px auto;padding:0 16px}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}
    h1{font-size:clamp(22px,3vw,28px);margin:0}
    .grid{display:grid;grid-template-columns:1.1fr .9fr;gap:18px}
    @media(max-width:900px){.grid{grid-template-columns:1fr}}
    .card{background:rgba(255,255,255,.03);border:1px solid rgba(148,163,184,.12);border-radius:18px;box-shadow:0 10px 30px rgba(2,8,23,.35)}
    .card .body{padding:18px}
    input,select{width:100%;padding:12px;border-radius:12px;border:1px solid rgba(148,163,184,.25);background:#0b1224;color:#e2e8f0}
    .result{margin-top:14px;padding:14px;border-radius:12px;background:rgba(34,211,238,.08);border:1px solid rgba(34,211,238,.25)}
    .footer{color:#94a3b8;font-size:12px;text-align:center;margin:28px 0 12px}
    #map{height:250px;border-radius:12px;margin-top:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Logística Inteligente 360 — MVB</h1>
        <div>Calculadora, rastreamento e GPS em tempo real. Protótipo funcional.</div>
      </div>
    </header>

    <!-- Autenticação (Supabase) -->
    <section class="card" id="authCard" style="margin-bottom:18px">
      <div class="body">
        <h2>Acesso do Operador</h2>
        <div id="authLogged" style="display:none">
          <div class="result"><div>
            <b>Logado:</b> <span id="usrEmail">—</span>
          </div>
          <div><button id="btnSignOut">Sair</button></div></div>
        </div>
        <div id="authForm">
          <div class="row">
            <div>
              <label for="loginEmail">E-mail</label>
              <input id="loginEmail" type="email" placeholder="seuemail@empresa.com"/>
            </div>
            <div style="display:flex; align-items:flex-end"><button id="btnSignIn">Entrar com e-mail</button></div>
          </div>
          <div class="subtitle">Usa magic link por e-mail. (Requer configuração Supabase)</div>
        </div>
      </div>
    </section>

    <section class="grid">
      <div class="card"><div class="body">
        <h2>Calculadora logística</h2>
        <label>Origem</label><input id="origem" placeholder="São Paulo - SP" />
        <label>Destino</label><input id="destino" placeholder="Belo Horizonte - MG" />
        <label>Peso (kg)</label><input id="peso" type="number" />
        <label>Volume (m³)</label><input id="volume" type="number" />
        <label>Modal</label><select id="modal"><option value="rodoviario">Rodoviário</option><option value="aereo">Aéreo</option><option value="maritimo">Marítimo</option></select>
        <div class="result" id="calcOut" hidden>
          <p><b>Custo:</b> <span id="outCusto"></span></p>
          <p><b>Prazo:</b> <span id="outPrazo"></span></p>
          <div style="display:flex; gap:12px; margin-top:8px">
            <button id="btnSaveQuote" disabled>Salvar cotação</button>
            <span class="subtitle" id="saveQuoteHint">Entre para salvar</span>
          </div>
        </div>
      </div></div>

      <div class="card"><div class="body">
        <h2>Rastreamento de pedido</h2>
        <label>Número do pedido</label><input id="pedido" placeholder="LI360-2025-000123" />
        <div class="result" id="trackOut" hidden>
          <p><b>Status:</b> <span id="statusTxt"></span></p>
          <p id="lastUpd"></p>
          <div style="display:flex; gap:12px; margin:8px 0">
            <button id="btnSaveShipment" disabled>Registrar pedido</button>
            <button id="btnAddEvent" disabled>Adicionar evento</button>
            <span class="subtitle" id="shipHint">Entre para registrar</span>
          </div>
          <div id="map"></div>
        </div>
      </div></div>
    </section>

    <div class="footer">
      Protótipo viável básico desenvolvido por <b>Maria Cristina Rocha Garcia</b>. © <span id="ano"></span>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
  <script>
    const fmtBRL=v=>v.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
    const origem=document.getElementById('origem'),destino=document.getElementById('destino'),peso=document.getElementById('peso'),volume=document.getElementById('volume'),modal=document.getElementById('modal');
    const calcOut=document.getElementById('calcOut'),outCusto=document.getElementById('outCusto'),outPrazo=document.getElementById('outPrazo');
    function calcFrete(){const p=parseFloat(peso.value)||0,v=parseFloat(volume.value)||0,m=modal.value;if(!origem.value||!destino.value||(!p&&!v)){calcOut.hidden=true;return;}const dist=500;const cfg={rodoviario:{base:45,km:2.6,kg:0.35,m3:180,vel:420},aereo:{base:120,km:5.8,kg:0.95,m3:420,vel:1600},maritimo:{base:80,km:1.4,kg:0.18,m3:95,vel:280}}[m];const custo=cfg.base+dist*cfg.km+p*cfg.kg+v*cfg.m3;const dias=Math.ceil(dist/cfg.vel);outCusto.textContent=fmtBRL(custo);outPrazo.textContent=dias+' dias';calcOut.hidden=false;}
    ;['input','change'].forEach(ev=>{origem.addEventListener(ev,calcFrete);destino.addEventListener(ev,calcFrete);peso.addEventListener(ev,calcFrete);volume.addEventListener(ev,calcFrete);modal.addEventListener(ev,calcFrete)});

    const pedido=document.getElementById('pedido'),trackOut=document.getElementById('trackOut'),statusTxt=document.getElementById('statusTxt'),lastUpd=document.getElementById('lastUpd');
    let map,marker,step=0;const route=[[-23.55,-46.63],[-22.41,-45.45],[-21.17,-44.94],[-19.91,-43.93]];
    function track(){if(!pedido.value){trackOut.hidden=true;return;}const etapas=['Pedido registrado','Em trânsito','Saiu para entrega','Entregue'];const etapa=etapas[Math.floor(Date.now()/10000)%etapas.length];statusTxt.textContent=etapa;lastUpd.textContent='Última atualização: '+new Date().toLocaleString('pt-BR');trackOut.hidden=false;if(!map){map=L.map('map').setView(route[0],6);L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'© OpenStreetMap'}).addTo(map);marker=L.marker(route[0]).addTo(map);}step=(step+1)%route.length;marker.setLatLng(route[step]);map.panTo(route[step]);}
    pedido.addEventListener('input',track);setInterval(track,5000);
    document.getElementById('ano').textContent=new Date().getFullYear();
  </script>
  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'
    const SUPABASE_URL = 'https://YOUR-PROJECT.supabase.co'
    const SUPABASE_ANON_KEY = 'YOUR_PUBLIC_ANON_KEY'
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)

    const authForm = document.getElementById('authForm')
    const authLogged = document.getElementById('authLogged')
    const usrEmail = document.getElementById('usrEmail')
    const btnSignIn = document.getElementById('btnSignIn')
    const btnSignOut = document.getElementById('btnSignOut')
    const loginEmail = document.getElementById('loginEmail')

    const btnSaveQuote = document.getElementById('btnSaveQuote')
    const btnSaveShipment = document.getElementById('btnSaveShipment')
    const btnAddEvent = document.getElementById('btnAddEvent')
    const shipHint = document.getElementById('shipHint')
    const saveQuoteHint = document.getElementById('saveQuoteHint')

    function setLogged(email){
      const on = !!email
      if(authForm) authForm.style.display = on ? 'none' : 'block'
      if(authLogged) authLogged.style.display = on ? 'block' : 'none'
      if(usrEmail) usrEmail.textContent = email || '—'
      if(btnSaveQuote) btnSaveQuote.disabled = !on
      if(btnSaveShipment) btnSaveShipment.disabled = !on
      if(btnAddEvent) btnAddEvent.disabled = !on
      if(shipHint) shipHint.style.display = on ? 'none' : 'inline'
      if(saveQuoteHint) saveQuoteHint.style.display = on ? 'none' : 'inline'
    }

    supabase.auth.getSession().then(({ data }) => setLogged(data.session?.user?.email))
    supabase.auth.onAuthStateChange((_evt, session)=> setLogged(session?.user?.email))

    btnSignIn?.addEventListener('click', async ()=>{
      const email = loginEmail.value.trim()
      if(!email) return alert('Informe seu e-mail')
      const { error } = await supabase.auth.signInWithOtp({ email })
      if(error) alert('Erro ao enviar link: '+ error.message)
      else alert('Enviamos um link de acesso para '+ email)
    })
    btnSignOut?.addEventListener('click', async ()=>{ await supabase.auth.signOut() })

    const origem = document.getElementById('origem')
    const destino = document.getElementById('destino')
    const peso = document.getElementById('peso')
    const volume = document.getElementById('volume')
    const modal = document.getElementById('modal')
    const outCusto = document.getElementById('outCusto')
    const outPrazo = document.getElementById('outPrazo')
    const pedido = document.getElementById('pedido')

    function parseNumber(el){ return parseFloat(el?.value)||0 }

    btnSaveQuote?.addEventListener('click', async ()=>{
      const payload = {
        origem: origem?.value, destino: destino?.value,
        peso: parseNumber(peso), volume: parseNumber(volume), modal: modal?.value,
        custo: outCusto?.textContent || null, prazo: outPrazo?.textContent || null,
        created_at: new Date().toISOString()
      }
      const { data, error } = await supabase.from('quotes').insert(payload).select('id')
      if(error){ alert('Erro ao salvar cotação: '+ error.message) }
      else{ alert('Cotação salva! ID '+ data[0].id) }
    })

    btnSaveShipment?.addEventListener('click', async ()=>{
      const code = (pedido?.value||'').trim()
      if(!code) return alert('Informe o número do pedido')
      const payload = {
        code,
        origem: origem?.value, destino: destino?.value,
        modal: modal?.value, status: document.getElementById('statusTxt')?.textContent || 'Registrado',
        eta: document.getElementById('outPrazo')?.textContent || null,
        created_at: new Date().toISOString()
      }
      const { data, error } = await supabase.from('shipments').insert(payload).select('id')
      if(error){ alert('Erro ao registrar pedido: '+ error.message) }
      else{ alert('Pedido registrado! ID '+ data[0].id) }
    })

    btnAddEvent?.addEventListener('click', async ()=>{
      const code = (pedido?.value||'').trim()
      if(!code) return alert('Informe o número do pedido')
      const payload = { code, type: 'status', message: document.getElementById('statusTxt')?.textContent || 'Atualização', ts: new Date().toISOString() }
      const { error } = await supabase.from('events').insert(payload)
      if(error){ alert('Erro ao adicionar evento: '+ error.message) }
      else{ alert('Evento adicionado!') }
    })
  </script>
</body>
</html>





  
     

 
   

   
    
